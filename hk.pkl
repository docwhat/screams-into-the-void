amends "package://github.com/jdx/hk/releases/download/v1.18.0/hk@1.18.0#/Config.pkl"
import "package://github.com/jdx/hk/releases/download/v1.18.0/hk@1.18.0#/Builtins.pkl"

min_hk_version = "1.18.0"
env {
    ["HK_MISE"] = "1"
}
exclude = List(
    "addons/**"
)

local linters = new Mapping<String, Step> {
    ["markdown"] = Builtins.markdown_lint
    ["pickle"] = Builtins.pkl
    ["taplo"] = Builtins.taplo
    ["yamllint"] = Builtins.yamllint
    ["yq"] = Builtins.yq

    ["mise"] {
        glob = "mise.toml"
        check = "mise fmt --check"
        fix = "mise fmt"
    }

    ["no-n-a-r-f"] {
        glob = "*"
        check = "mise run ::: no-n-a-r-f -- {{files}}"
    }

    ["gdscript-formatter"] {
        glob = "*.gd"
        check = "gdscript-formatter lint {{files}}"
        fix = "gdscript-formatter --safe {{files}}"
    }
}

hooks {
    ["pre-commit"] {
        fix = true    // automatically modify files with available linter fixes
        stash = false // stashes unstaged changes while running fix steps
        steps = linters
    }
    // instead of pre-commit, you can instead define pre-push hooks
    ["pre-push"] {
        steps = linters
    }
    // "fix" and "check" are special steps for `hk fix` and `hk check` commands
    ["fix"] {
        fix = true
        steps = linters
    }
    ["check"] {
        steps = linters
    }
}
