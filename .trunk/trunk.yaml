# This file controls the behavior of Trunk: https://docs.trunk.io/cli
# To learn more about the format of this file, see https://docs.trunk.io/reference/trunk-yaml
version: 0.1
cli:
    version: 1.25.0
# Trunk provides extensibility via plugins. (https://docs.trunk.io/plugins)
plugins:
    sources:
        - id: trunk
          ref: v1.7.4
          uri: https://github.com/trunk-io/plugins
# Many linters and tools depend on runtimes - configure them here. (https://docs.trunk.io/runtimes)
runtimes:
    enabled:
        - go@1.21.0
        - node@22.16.0
        - python@3.10.8
        - rust@1.88.0
# This is the section where you manage your linters. (https://docs.trunk.io/check/configuration)
lint:
    files:
        - name: gdscript
          extensions:
              - gd
          comments:
              - hash
    ignore:
        - linters: [ALL]
          paths:
              - addons/**
    enabled:
        - actionlint@1.7.9
        - bandit@1.9.1
        - black@25.11.0
        - checkov@3.2.494
        - git-diff-check
        - isort@7.0.0
        - markdownlint@0.46.0
        - oxipng@9.1.5
        - prettier@3.6.2
        - ruff@0.14.5
        - shellcheck@0.11.0
        - shfmt@3.6.0
        - svgo@4.0.0
        - taplo@0.10.0
        - trufflehog@3.91.1
        - yamllint@1.37.1
        - gdscript-formatter@0.18.0
    definitions:
        - name: gdscript-formatter
          description: Formats GDScript (Godot's scripting language)
          files: [gdscript]
          tools: [gdscript-formatter]
          known_good_version: 0.18.0
          suggest_if: files_present
          commands:
              - name: lint
                run: gdscript-formatter lint ${target}
                output: regex
                batch: true
                # bad.gd:15:unused-argument:warning: Function argument 'argument' is unused. Consider removing it or prefixing with '_'
                parse_regex: ((?P<path>[^:]+):(?P<line>\d+):(?P<code>[^:]+):(?P<severity>[^:]+):\s*(?P<message>.*))

                success_codes: [0, 1]
                read_output_from: stdout
              - name: formatter
                output: rewrite
                formatter: true
                run: gdscript-formatter --safe --stdout ${target}
                success_codes: [0]
          version_command:
              parse_regex: ${semver}
              run: gdscript-formatter --version
actions:
    disabled:
        - commitizen
    enabled:
        - commitlint
        - trunk-announce
        - trunk-check-pre-push
        - trunk-fmt-pre-commit
        - trunk-upgrade-available
tools:
    enabled:
        - commitizen@4.3.1
    definitions:
        - name: gdscript-formatter
          runtime: rust
          package: gdscript-formatter:https://github.com/gdquest/gdscript-formatter.git
          shims:
              - name: gdscript-formatter
                target: gdscript-formatter
          # Requires rust 1.88.0 at minumum
          known_good_version: 0.18.0
          health_checks:
              - command: gdscript-formatter --version
                parse_regex: ${semver}
